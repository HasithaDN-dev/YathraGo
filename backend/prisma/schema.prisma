// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init


datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// --------------------------------------------------
// MODELS
// --------------------------------------------------


generator client {
  provider = "prisma-client-js"
}

model User {
  id                  Int              @id @default(autoincrement())
  phone               String           @unique
  email               String?          @unique
  firstName           String?
  lastName            String?
  accountType         AccountType?     // 'CHILD' or 'STAFF'
  registrationStatus  RegistrationStatus @default(OTP_PENDING)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime         @updatedAt

  // Relations
  staff_Passenger      Staff_Passenger?
  children            Child[]          @relation("UserChildren")
}

model Admin {
  id          Int @id @default(autoincrement())
  email       String   @unique
  password    String
  firstName   String
  lastName    String
  permissions String[] // Array of permission strings
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Manager {
  id         Int @id @default(autoincrement())
  email      String   @unique
  password   String
  firstName  String
  lastName   String
  department String?  // Optional department field
  level      String   @default("JUNIOR") // JUNIOR, SENIOR, EXECUTIVE
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
 }

model Vehicle {
  id Int @id @default(autoincrement())
  type String 
  brand String
  model String
  manufactureYear Int
  registrationNumber String
  color String
  route String[]
  no_of_seats Int
  air_conditioned Boolean @default(false)
  assistant Boolean @default(false)
  rear_picture_url String
  front_picture_url String
  side_picture_url String
  inside_picture_url String
  revenue_license_url String
  insurance_front_url String
  insurance_back_url String
  vehicle_reg_url String

}

model Chat {
  id Int @id @default(autoincrement())
  message String
  timestamp DateTime @default(now())
  seen Boolean @default(false)

}

model BackupDriver {
  id Int @id @default(autoincrement())
  name String
  phone String
  vehicle_Reg_No String
  NIC String
}

model Absence_Child {
  absent_id    Int    @id @default(autoincrement())
  reason       String
  createdAt    DateTime @default(now())
}

model DriverNotification {
  id Int @id @default(autoincrement())
  title String
  message String
  date DateTime @default(now())

  
}

model MonthlyPayment {
  id Int @id @default(autoincrement())
  amount Float
  paid Boolean @default(false)
  paymentDate DateTime @default(now())
  month String
  Status String @default("Pending") // Pending, Paid, Overdue
 
}

model PaymentBalance {
  id Int @id @default(autoincrement())
  month String
  amountDue Float
  balance    Float
  date DateTime @default(now())
  description String
  type String // Income or Expense
}

model StaffEmergency {
  id Int @id @default(autoincrement())
  type String 
  description String
  OccurrenceDate DateTime

}

model ChildEmergency {
  id Int @id @default(autoincrement())
  type String 
  description String
  OccurrenceDate DateTime
  
}

model Driver {
  id Int @id @default(autoincrement())
  first_name String
  last_name String
  phone String
  second_phone String
  gender String
  vehicle_Reg_No String
  NIC String
  address String
  profile_picture_url String
  driver_license_front_url String
  driver_license_back_url String
  nic_front_pic_url String
  nice_back_pic_url String
  date_of_birth DateTime
  date_of_joining DateTime @default(now())
}

model FoundedBackupDrivers {
  id Int @id @default(autoincrement())
}

model VehicleOwner {
  id Int @id @default(autoincrement())
  first_name String
  last_name String
  phone String
  email String
}

model Customer {
  user_id           Int      @id @default(autoincrement())
  name              String
  email             String  
  contact           String  
  otp               String   
  address           String
  profileImageUrl   String
  emergencyContact  String   
  status            String
  createdAt         DateTime 
}

model Complaints {
  complaint_id Int    @id @default(autoincrement())
  description  String
  type         String
  createdAt    DateTime @default(now())
}

model Inquires {
  inquiry_id   Int    @id @default(autoincrement())
  description  String
  createdAt    DateTime @default(now())
}

model Absence_Staff {
  absent_id    Int    @id @default(autoincrement())
  reason       String
  createdAt    DateTime @default(now())
}

model Ratings_and_Reviews {
  review_id    Int    @id @default(autoincrement())
  review       String
  ratings      Int
  createdAt    DateTime @default(now())
}

model Child {
  id                  Int     @id @default(autoincrement())
  userId              Int?    // The user account that "owns" this child record
  staffPassengerId    Int?    // The staff passenger profile of the parent

  childName           String
  relationship        String
  nearbyCity          String
  school              String
  schoolLocation      String
  pickUpAddress       String
  childImageUrl       String?

  // Relations
  staff_Passenger      Staff_Passenger? @relation(fields: [staffPassengerId], references: [id])
  user                User?           @relation("UserChildren", fields: [userId], references: [id])
}

model Child_Trip {
  childTrip_id    Int    @id @default(autoincrement())
  date            DateTime @default(now())
  pickUp          String
  dropOff         String
  startTime       DateTime
  endTime         DateTime
}

model Staff_Passenger {
  id               Int    @id @default(autoincrement())
  userId           Int    @unique
  nearbyCity       String
  workLocation     String
  workAddress      String
  pickUpLocation   String
  pickupAddress    String

  // Relations
  user             User   @relation(fields: [userId], references: [id])
  children         Child[]
}


model Staff_Trip {
  staffTrip_id    Int    @id @default(autoincrement())
  pickUpLocation  String
  dropOffLocation String
  startTime       DateTime
  endTime         DateTime
  date            DateTime @default(now())
}

model Child_Assign_To {
  assign_id       Int    @id @default(autoincrement())
  createdAt       DateTime @default(now())
}

// --------------------------------------------------
// ENUMS
// --------------------------------------------------

enum AccountType {
  CHILD
  STAFF
}

enum RegistrationStatus {
  OTP_PENDING
  OTP_VERIFIED
  TYPE_SELECTED
  CHILD_REGISTERED
  STAFF_REGISTERED
}